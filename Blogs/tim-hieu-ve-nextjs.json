{
    "rawContent": "<div class=\"post-body\">\n    <figure>\n        <img\n                src=\"https://i.postimg.cc/prpZCJRr/nextjs-thumbnail.jpg\"\n                alt=\"NextJS\"\n        />\n        <figcaption>NextJS</figcaption>\n    </figure>\n\n    <h1 id=\"mo-dau\">Mở đầu</h1>\n\n    <p>\n        Sau một thời gian làm việc với <code>ReactJS</code> và \n        <strong>Client Side Rendering (CSR)</strong> thì gần đây, mình \n        đang tìm hiểu về việc thực hiện <strong>Server Side Rendering (SSR)</strong>\n        với <code>ReactJS</code> cụ thể là <code>NextJS</code> - một framework \n        cho chúng ta thực hiện <strong>SSR</strong> với <code>ReactJS</code>.\n        Khi viết bài này mình cũng đang trong quá trình mới tìm hiểu về\n        <code>NextJS</code> nên bài này sẽ không hề chứa các lời khuyên hay \n        đứa ra các cách làm tốt nhất mà đơn giản chỉ là chia sẻ lại cho các \n        bạn những gì mình tìm hiểu được và mong rằng sẽ tiết kiệm cho các bạn \n        một chút thời gian khi chuyển từ <strong>CSR</strong> sang <strong>SSR</strong>\n        với <code>NextJS</code>. Trước khi các bạn tiếp tục đọc bài này và cũng là \n        để dễ dàng hơn cho bạn thì các bạn nên:\n    </p>\n\n    <ul>\n        <li>\n            <p>\n                Hiểu biết cơ bản về <strong>Client Side Rendering</strong> \n                và <strong>Server Side Rendering</strong>\n            </p>\n        </li>\n        <li>\n            <p>\n                Có kiến thức cơ bản về <code>ReactJS</code>\n            </p>\n        </li>\n    </ul>\n\n    <h1 id=\"nextjs\">NextJS</h1>\n\n    <p>\n        Ngay khi vào trang chủ của <a target=\"_blank\" href=\"https://nextjs.org/\">NextJS</a> thì \n        ngay lập tức ta biết được ngay nó là gì cũng như ứng dụng của nó:\n    </p>\n\n    <p>\n        Về cơ bản thì với việc <strong>SSR</strong> thì <code>NextJS</code> \n        giới thiệu là sẽ cung cấp cho chúng ta một số thứ như:\n    </p>\n\n    <ul>\n        <li>\n            <p>\n                Hiệu năng tốt hơn so với ứng dụng <strong>CSR</strong>\n            </p>\n        </li>\n        <li>\n            <p>\n                Mang lại khả năng SEO tốt hơn mà <strong>CSR</strong>\n                không có như là việc chia sẻ bài viết.\n            </p>\n        </li>\n    </ul>\n\n    <p>\n        Trên trang chủ thì bạn cũng có thể tìm thấy rất nhiều các website đang \n        sử dụng <code>NextJS</code> để xây dựng sản phẩm của mình trên mọi lĩnh \n        vực như tài chính, tin tức, thuwong mại điện tử, ... . Giới thiệu qua \n        cho các bạn như vậy còn bây giờ chúng ta sẽ đi vào những gì mình đã tìm \n        hiểu được.\n    </p>\n\n    <h2 id=\"khoi-tao-ung-dung-nextjs\">Khởi tạo ứng dụng NextJS</h2>\n\n    <p>\n        Tương tự với <strong>creat-react-app</strong> của <code>ReactJS</code>\n        thì với <code>NextJS</code> ta cũng có công cụ tương tự là\n        <strong>create-next-app</strong>. Bạn có thể cài đăt và xem hướng dẫn cài \n        đặt chi tiết ở <a target=\"_blank\" href=\"https://github.com/vercel/create-next-app\">đây</a>. \n        Sau khi cài việc cài đặt thành công ta có thể khởi tạo một ứng dụng <code>NextJS</code> \n        mới với lệnh:\n    </p>\n\n    <pre><code>\n        $ create-react-app learn-nextjs\n    </code></pre>\n\n    <p>\n        Sau khi tạo ta sẽ có được cây thư mục như sau:\n    </p>\n\n    <figure>\n        <img \n            src=\"https://i.postimg.cc/SsB6DHrP/nextjs-folder.png\" \n            alt=\"Folder\"\n        />\n        <figcaption>Cây thư mục sau khi khởi tạo NextJS</figcaption>\n    </figure>\n\n    <p>\n        Với cây thư mục này thì ta cần quan tầm đến một số thứ như:\n    </p>\n\n    <ul>\n        <li>\n            <p>\n                <code>components</code>: như cái tên thì nó sẽ là nơi \n                chức các component cho ứng dụng của chúng ta.\n            </p>\n        </li>\n        <li>\n            <p>\n                <code>pages</code>: đây là nơi chứa các trang mà chúng \n                ta truy cập từ url vào, cụ thể mình sẽ nói đến ở dưới.\n            </p>\n        </li>\n        <li>\n            <p>\n                <code>static</code>: là thư mục chứa các file static của \n                chúng ta như ảnh, css, ...\n            </p>\n        </li>\n        <li>\n            <p>\n                <code>next.config.js</code>: cũng như cái tên thì nó là fie \n                chứa config cho ứng dụng của chúng ta.\n            </p>\n        </li>\n    </ul>\n\n    <h2 id=\"su-dung-scss\">Sử dụng SCSS</h2>\n\n    <p>\n        <code>ReactJS</code> hay <code>NextJS</code> thì đều là để nhắm đến \n        phần UI cho nên với mình việc làm sao để có thể style cho các component \n        trong ứng dụng của chúng ta là một trong những thứ đầu tiên mình quan \n        tâm. Thông thường với ứng dụng <code>ReactJS</code> thì mình sẽ sử dụng\n        <code>SCSS</code> và việc này cũng đã được <strong>create-react-app</strong>\n        hỗ trợ sẵn. Tuy nhiên với <code>NextJS</code> để sử dụng được <code>SCSS</code>\n        thì ta phải cài thêm một package là <code>@zeit/next-sass</code>\n        như sau:\n    </p>\n\n    <pre><code>\n        yarn add @zeit/next-sass node-sass\n    </code></pre>\n\n    <p>\n        Trong file <code>next.config.js </code> thêm nội dung sau:\n    </p>\n\n    <pre><code class=\"language-javascript\">const withSass = require('@zeit/next-sass');\nmodule.exports = withSass();\n    </code></pre>\n\n    <p>\n        Có một lưu ý là bạn bắt buộc phải import ít nhất một file <code>.scss</code>\n        vào các file trong folder <code>/pages</code> nếu không bạn sẽ gặp phải một bug \n        khá kì lạ đó là khi bạn vào trang không được import file <code>.scss</code>\n        đầu tiên khi truy cập ứng dụng thì sẽ không bấm chuyển trang được. Bug này đã \n        được cộng đồng phát hiện và mong rằng sẽ sớm được fix trong thời gian tới.\n    </p>\n\n    <h2 id=\"su-dung-cac-file-static\">Sử dụng các file static</h2>\n\n    <p>\n        Một điều quan trọng nữa đối với UI là ta sẽ cần phải chèn ảnh vào trang của chúng ta. \n        Như ở trên mình đã nói là chúng ta có một folder là <code>/statics</code>.\n        Đối với ảnh thì bên trong ta nên tạo thêm một folder là <code>/images</code>\n        và lưu ảnh vào đó. Lúc này ở trong bất cứ component nào ta có thể sử dụng ảnh đó bằng \n        cách như sau:\n    </p>\n\n    <pre><code class=\"language-javascript\">const MyImage = () => (\n        &lt;img src=\"/statis/images/my-image.png\" /&gt;\n    );\n    </code></pre>\n\n    <h2 id=\"su-dung-next/head\">Sử dụng next/head</h2>\n\n    <p>\n        Để hỗ trợ cho việc SEO cũng như chia sẻ thì <code>NextJS</code>\n        cung cấp cho chúng ta một component là <code>next/head</code>.\n        Cách sử dụng như sau:\n    </p>\n\n    <pre><code class=\"language-javascript\">import Head from 'next/head';\n\nfunction IndexPage() {\n    return (\n    &lt;div&gt;\n        &lt;Head&gt;\n        &lt;title&gt;My page title&lt;/title&gt;\n        &lt;meta name=\"viewport\" content=\"initial-scale=1.0, width=device-width\" /&gt;\n        &lt;/Head&gt;\n        &lt;p&gt;Hello world!&lt;/p&gt;\n    &lt;/div&gt;\n    );\n}\n\nexport default IndexPage;\n    </code></pre>\n\n    <p>\n        Về cơ bản nội dung mà chúng ta khai báo trong phần <code>&lt;Head&gt;</code>\n        này sẽ được thêm vào phần <code>&lt;head&gt;</code> trang html mà chúng ta trả \n        về cho user. Điều này đồng nghĩa với tùy trang ta có thể truyền thêm \n        các thông tin như <code>title</code>, <code>meta</code>, <code>og:image</code>,\n        <code>og:title</code>, ... để có thể share lên các trang khác như facebook.\n    </p>\n\n    <h2 id=\"fetch-du-lieu-tu-server\">Fetch dữ liệu từ server</h2>\n\n    <p>\n        Để có được các thông tin về trang để điền vào phần <code>&lt;Head&gt;</code> ở trên thì ta sẽ cần \n        thêm thông tin từ phía server. Ví dụ trong trường hợp bạn copy link một bài viết \n        của mình và paste vào comment trên facebook và nhận được kết quả như sau:\n    </p>\n\n    <p>\n        Thì tất nhiên phần <code>&lt;Head&gt;</code> của trang chúng ta sẽ cần điền tối thiểu các phần \n        thông tin như <code>og:image</code> và <code>og:title</code> mà các thông tin này sẽ có \n        được bằng cách ta lấy dữ liệu từ server. <code>NextJS</code> cung cấp cho chúng ta thêm \n        một hàm có tên là <code>getInitialProps()</code> có chức năng có thể hiểu là giống như\n        <code>componentDidMount()</code> nhưng hoạt động được với <strong>SSR</strong>\n        và có là thay thế được cho <code>componentDidMount()</code> với ứng dụng SSR. Cụ thể như sau:\n    </p>\n\n    <pre><code class=\"language-javascript\">import React, { Component } from 'react';\nimport axios from 'axios';\n\nclass HelloUA extends Component {\n    \n    static async getInitialProps({ req }) {\n        const response = await axios.get('http://localhost:8000/api/v0/posts');\n        const data = response.data;\n\n        return {\n            data\n        };\n        }\n\n        render() {\n        return &lt;div&gt;Number of post: {this.data.length}&lt;/div&gt;\n        }\n}\n\nexport default HelloUA;\n    </code></pre>\n\n    <p>\n        Hàm này bắt buộc phải return nội dung là một <strong>Object</strong> \n        thông thường chứ không được thuộc dạng <strong>Date</strong>, <strong>Map</strong>, \n        hay <strong>Set</strong>. Hàm này sẽ được gọi lại nếu được chuyển hướng tới URL \n        khác thông qua <code>next/link</code> (sẽ nói đến ở mục sau). Đồng thời ta cũng \n        có thể sử dụng hàm <code>getInitialProps()</code> trong stateless component như sau:\n    </p>\n\n    <pre><code class=\"language-javascript\">import React, { Component } from 'react';\nimport axios from 'axios';\n\nconst HelloUA = ({ data }) => (\n    &lt;div&gt;Number of post: {this.data.length}&lt;/div&gt;\n);\n\nHelloUA.getInitialProps = async ({ req }) => {\n    const response = await axios.get('http://localhost:8000/api/v0/posts');\n    const data = response.data;\n\n    return {\n        data\n    };\n}\n    </code></pre>\n\n    <p>\n        <em>\n            Lưu ý: hàm <code>getInitialProps()</code> chỉ hoạt động trong <code>/pages</code>.\n            Đồng thời hàm này cũng nhận vào một tham số là một request object chứa các thông \n            tin như queryParameter, ... .\n        </em>\n    </p>\n\n    <h2 id=\"routing\">Routing</h2>\n\n    <p>\n        <code>NextJS</code> sẽ tự động tạo thành các <code>router</code> \n        đối với các file mà bạn tạo trong folder <code>/pages</code>, ví dụ:\n    </p>\n\n    <ul>\n        <li>\n            <p>\n                <code>pages/index.js</code> sẽ ứng với url gốc là \n                <code>/</code>\n            </p>\n        </li>\n        <li>\n            <p>\n                <code>pages/post/index.js</code> sẽ ứng với url gốc là: \n                <code>/post</code>\n            </p>\n        </li>\n        <li>\n            <p>\n                <code>pages/post/create.js</code> sẽ ứng với url gốc là: \n                <code>/post/create</code>\n            </p>\n        </li>\n    </ul>\n\n    <p>\n        Tuy nhiên với trường hợp bạn muốn url của bạn có dạng <code>/post/:postId</code>\n        thì lúc này ta sẽ cần dùng đến 1 file đóng vai trò là server như sau:\n    </p>\n\n    <pre><code class=\"language-javascript\">const express = require('express');\nconst next = require('next');\n\nconst dev = process.env.NODE_ENV !== 'production';\nconst app = next({ dev });\nconst handle = app.getRequestHandler();\nconst server = express();\n\napp.prepare()\n    .then(() => {\n\n        // Slug on url\n        server.get('/post/:postId', (req, res) => {\n            console.log(req.params.postId);\n            return app.render(req, res, '/post', { postId: req.params.postId })\n        });\n\n        server.get('*', (req, res) => {\n            return handle(req, res);\n        });\n\n        server.listen(3000, err => {\n            if (err) console.log(err)\n            console.log('> Ready on port 3000');\n        })\n    })\n    .catch(err => {\n        console.log(err);\n        process.exit();\n    });\n    </code></pre>\n\n    <p>\n        Về cơ bản đây là file <code>server.js</code> có vai trò hỗ trợ việc \n        <strong>SSR</strong>. Vì phần <code>postId</code> kìa là tham số động\n        và ta không có cách nào để tạo ra url động dưới dạng đó theo quy tắc \n        sinh url theo page của <code>NextJS</code>. Với cách viết trên thì cái \n        url có dạng <code>/post/:postId</code> sẽ được bên client hiểu là \n        <code>/post?postId=?</code> nhưng với cơ chế rewrite url nên nó sẽ là\n        <code>/post/:postId</code> và trong component của chúng ta có thể lấy được \n        <code>postId</code> này như một query param như sau:\n    </p>\n\n    <pre><code class=\"language-javascript\">import React from 'react';\nimport Link from 'next/link';\nimport axios from 'axios'\n\nimport '../../static/scss/style.scss';\n\nconst PostPage = (props) => (\n    &lt;div&gt;\n        &lt;p&gt;{props.data.title}&lt;/p&gt;\n        &lt;Link href=\"/\"&gt;\n            &lt;a&gt;Back&lt;/a&gt;\n        &lt;/Link&gt;\n    &lt;/div&gt;\n);\n\nPostPage.getInitialProps = async ({ query }) => {\n    const postId = query.postId\n    const res = await axios.get(`http://localhost:8000/api/v0/posts/${postId}`);\n\n    return { data: res.data };\n};\n\nexport default PostPage;\n    </code></pre>\n\n    <p>\n        Với đoạn code trên khi lần đầu ta truy cập vào trang với url <code>/post/1</code> \n        thì trong component của chúng ta sẽ lấy được số 1 giống ứng với <code>postId</code> \n        và sử dụng nó để gọi API và lấy về post có id là 1 sau đó render ra giao diện tương \n        ứng trên server và trả về file nội dung html đầy đủ cho chúng ta. Tuy nhiên đó là \n        cách mà ta khai báo router với SSR còn với Client thì chúng ta sẽ sử dụng thẻ \n        <code>next/link</code> để thực hiện việc điều hướng.\n    </p>\n\n    <h2 id=\"link\">Link</h2>\n\n    <p>\n        <code>NextJS</code> cung cấp sẵn cho chúng ta một component là <code>next/link</code> \n        giống như component <code>&lt;Link/&gt;</code> trong <code>react-route</code>. \n        Tuy nhiên khi sử dụng cú pháp sẽ như sau: \n    </p>\n\n    <pre><code class=\"language-javascript\">// pages/index.js\nimport NextLink from 'next/link';\n\nfunction Home() {\n    return (\n    &lt;div&gt;\n        &lt;NextLink href=\"/about\"&gt;\n        &lt;a&gt;Back to home&lt;/a&gt;\n        &lt;/NextLink&gt;\n    &lt;/div&gt;\n    );\n}\n\nexport default Home;\n    </code></pre>\n\n    <p>\n        Như bạn có thể thấy component <code>&lt;NextLink/&lt;</code> sẽ bắt buộc phải có một \n        thuộc tính là <strong>href</strong> để trỏ đến đường dẫn cần thiết và đặc \n        biệt bên trong nó phải chứa một cặp thẻ bất kì như <code>&lt;a&gt;&lt;/a&gt;</code>, \n        <code>&lt;button&gt;&lt;/button&gt;</code>, <code>&lt;div&gt;&lt;/div&gt;</code> ... \n        giống như trong ví dụ trên. Ngoài ra <code>next/link</code> còn nhận vào một tham số \n        nữa là <strong>as</strong> đóng vai trò như việc rewrite url. Ở phần nội dung trước \n        <strong>Routing</strong> chúng ta đã nói về việc sử dụng url có dạng <code>/post/:postId</code> \n        ở phía <strong>SSR</strong> còn ở phía client ta sẽ phải dùng <code>next/link</code> \n        như sau:\n    </p>\n\n    <pre><code class=\"language-javascript\">// pages/index.js\nimport NextLink from 'next/link';\n\nfunction Home() {\n    return (\n    &lt;div&gt;\n        &lt;NextLink href=\"/post?postId=1\" as=\"/post/1\"&gt;\n        &lt;a&gt;To post detail&lt;/a&gt;\n        &lt;/NextLink&gt;\n    &lt;/div&gt;\n    );\n}\n\nexport default Home;\n    </code></pre>\n\n    <p>\n        Như phần trước đã nói <code>postId</code> sẽ được coi như 1 query param trong\n        <strong>NextJS</strong> cho nên ta phải viết dưới dạng <code>/post?postId=1</code> \n        sau đó sử dụng thuộc tính thử 2 của <code>next/link</code> là <strong>as</strong> \n        để truyển nó về dạng ta mong muốn là <code>/post/1</code> vì ở client sẽ không cho \n        phép bạn viết sẵn kiểu <code>href=\"/post/:postId\"</code>\n    </p>\n\n    <p>\n        <em>\n            Lưu ý: nếu ta đang từ ở 1 trang khác ví dụ như trang <code>/</code> và bấm chuyển \n            trang với <code>nex/link </code> với <code>href=\"/post?postId=1\"</code> thì mọi \n            việc sẽ diễn ra như bình thường và ta có thế lấy cái <code>postId</code> đó như \n            query param bên component <code>&lt;Post/&gt;</code> tuy nhiên nếu ta reload lại \n            trang <code>/post/1</code> thì sẽ dẫn tới 404 vì mặc định bên client sẽ không hiểu \n            đường dẫn này mà nó chỉ hiểu <code>/post?postId=1</code> và rewrite lại thành \n            <code>/post/1</code>. Đó là lý do vì sao ta cần file <code>server.js</code> để hỗ \n            trợ các trường hợp như trên vì khi ta reload trang với url <code>/post/1</code> \n            thì trên server có thể lấy được tham số 1 đó và truyền nó lại vào phần render app \n            của chúng ta dưới dạng query param.\n        </em>\n    </p>\n\n    <p>\n        Ngoài cách sử dụng thẻ <code>next/link</code> ta cũng có thể dùng \n        gán một function vào phần tử bất kì trong UI để tiến hành thay đổi \n        url thông qua việc sử dụng <code>next/router</code>. Ví dụ với trường \n        hợp url là <code>/posts/1</code> ta có thể viết như sau:\n    </p>\n\n    <pre><code class=\"language-javascript\">import React from 'react';\nimport Router from 'next/router';\n        \nclass Home extends React.Component {\n    changeRouter = () => {\n        Router.push({\n            pathname: '/post',\n            query: { postId: 1 },\n            asPath: '/post/1'\n        });\n    }\n    \n    render() {\n        return (\n            &lt;div onClick={this.changeRouter}&gt;Click me!&lt;/div&gt;\n        )\n    }\n}\n        \nexport default Home;\n    </code></pre>\n\n    <h1 id=\"ket-bai\">Kết bài</h1>\n\n    <p>\n        Đến đây có lẽ các bạn đã có được khá nhiều thông tin về \n        <strong>NextJS</strong> và cách cài đặt. Trong những phần tiếp \n        theo, chúng mình sẽ tiếp tục chia sẻ thêm những thông tin hữu ích \n        khác mà mình tích lũy được. Nếu các bạn thấy có điều gì chưa \n        hợp lý hoặc có gì thắc mắc thì có thể comment ngay ở bên dưới nhé. \n        Cảm ơn các bạn đã đọc bài.\n    </p>\n\n</div>",
    "authorName": "Hai Anh",
    "timeRelease": "2021-11-07T18:30:00Z",
    "timeCreate": "2021-11-07T15:10:00Z",
    "title": "Tìm hiểu về NextJS",
    "subTitle": "Một công cụ giúp giải quyết các hạn chế của react về việc build full static, hay Server Side Rendering",
    "coverImgUrl": "https://i.postimg.cc/P5twz99S/haianh.jpg",
    "thumbnailImgUrl": "https://i.postimg.cc/prpZCJRr/nextjs-thumbnail.jpg",
    "blogTag": ["Javascript","ReactJS", "NextJS" ,"Web Development"]
  }